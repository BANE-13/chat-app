<!DOCTYPE html>
<html>
<head>
<link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet">
<meta charset="UTF-8">
<title>ì¹´í†¡ ë§í’ì„  ì±„íŒ…</title>

<style>
body {
  font-family: 'SUIT', -apple-system, BlinkMacSystemFont, sans-serif;
  background: #ececec;
}

#chatBox {
  max-width: 400px;
  margin: auto;
}

#chat {
  background: #ecdff5;
  padding: 10px;
  height: 400px;
  overflow-y: auto;
  border-radius: 10px;
}

.bubble {
  font-weight: 500;
  max-width: 70%;
  padding: 8px 12px;
  margin: 6px 0;
  border-radius: 10px;
  clear: both;
}

.me {
  background: #664b7d;
  float: right;
  text-align: right;
}

.other {
  background: white;
  float: left;
}

.name {
  font-weight: 400;
  opacity: 0.8;
  font-size: 12px;
  color: #555;
  margin-bottom: 2px;
}

#inputArea {
  display: flex;
  margin-top: 8px;
}

#msg {
  flex: 1;
  padding: 8px;
}

.time {
  font-size: 11px;
  color: #ffffff;
  margin-top: 4px;
}

/* ê³µí†µ ì…ë ¥ì°½ */
input {
  border: none;
  outline: none;
  border-radius: 20px;
  padding: 10px 14px;
  font-size: 14px;
}

/* ë²„íŠ¼ ê³µí†µ */
button {
  border: none;
  border-radius: 20px;
  padding: 10px 16px;
  background: #664b7d;
  color: white;
  cursor: pointer;
}

button:hover {
  opacity: 0.9;
}

/* ë‹‰ë„¤ì„ ì…ë ¥ í™”ë©´ */
#nicknameBox {
  max-width: 320px;
  margin: 80px auto;
  padding: 24px;
  background: white;
  border-radius: 14px;
  text-align: center;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
}

#nicknameBox h3 {
  margin-bottom: 16px;
}

/* ì±„íŒ… ì…ë ¥ ì˜ì—­ */
#inputArea {
  background: white;
  padding: 10px;
  border-radius: 20px;
  display: flex;
  gap: 8px;
}

/* ğŸ’› ë‚´ ë§í’ì„  í…ìŠ¤íŠ¸ í°ìƒ‰ */
.me {
  background: #664b7d;
  color: white; /* â­ ì´ê²Œ í•µì‹¬ */
}


</style>
</head>

<body>

<div id="nicknameBox">
  <h3>ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”</h3>
  <input id="nicknameInput" placeholder="ë‹‰ë„¤ì„">
  <button onclick="setNickname()">ì…ì¥</button>
</div>

<div id="chatBox" style="display:none;">
  <h2>ğŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ…</h2>

  <div id="chat"></div>

  <div id="inputArea">
    <input id="msg" placeholder="ë©”ì‹œì§€ ì…ë ¥">
    <button onclick="send()">ì „ì†¡</button>
  </div>
</div>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onChildAdded }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBeMC5TQ7Jynxjpr_kjhijGUvZyly2D_gs",
  authDomain: "my-chat-app-241e8.firebaseapp.com",
  databaseURL: "https://my-chat-app-241e8-default-rtdb.firebaseio.com",
  projectId: "my-chat-app-241e8",
  storageBucket: "my-chat-app-241e8.firebasestorage.app",
  messagingSenderId: "445144138482",
  appId: "1:445144138482:web:e9d6403b7c711b8c4d066b"
};


const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const chatRef = ref(db, "chat");

const chat = document.getElementById("chat");
const msg = document.getElementById("msg");
const nicknameInput = document.getElementById("nicknameInput");
const nicknameBox = document.getElementById("nicknameBox");
const chatBox = document.getElementById("chatBox");

let nickname = "";

window.setNickname = () => {
  nickname = nicknameInput.value.trim();
  if (!nickname) return;
  nicknameBox.style.display = "none";
  chatBox.style.display = "block";
};

window.send = () => {
  if (!msg.value.trim()) return;
  push(chatRef, {
    name: nickname,
    text: msg.value,
    time: Date.now()   // â­ ì‹œê°„ ì¶”ê°€
  });
  msg.value = "";
};

msg.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    send();
  }
});

function formatTime(timestamp) {
  const date = new Date(timestamp);
  let hours = date.getHours();
  const minutes = date.getMinutes().toString().padStart(2, "0");
  const ampm = hours >= 12 ? "ì˜¤í›„" : "ì˜¤ì „";

  hours = hours % 12 || 12;
  return `${ampm} ${hours}:${minutes}`;
}


onChildAdded(chatRef, snapshot => {
  const data = snapshot.val();

  const bubble = document.createElement("div");
  bubble.classList.add("bubble");

  if (data.name === nickname) {
    bubble.classList.add("me");
  } else {
    bubble.classList.add("other");

    const nameDiv = document.createElement("div");
    nameDiv.className = "name";
    nameDiv.textContent = data.name;
    bubble.appendChild(nameDiv);
  }

  const textDiv = document.createElement("div");
  textDiv.textContent = data.text;
  bubble.appendChild(textDiv);

  const timeDiv = document.createElement("div");
  timeDiv.className = "time";
  timeDiv.textContent = formatTime(data.time);
  bubble.appendChild(timeDiv);

  chat.appendChild(bubble);
  chat.scrollTop = chat.scrollHeight;
});

</script>

</body>
</html>
